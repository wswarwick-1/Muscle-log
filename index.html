<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Muscle Log</title>

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#2f2f2f;
  color:#f5f5f5;
}

header {
  background:#1f1f1f;
  padding:14px;
  font-size:18px;
  font-weight:600;
}

h1 {
  text-align:center;
  color:#f2c94c;
  margin:20px 0;
}

.container {
  max-width:520px;
  margin:auto;
  padding:12px;
}

.card {
  background:#3a3a3a;
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
}

button {
  width:100%;
  padding:14px;
  border-radius:16px;
  border:none;
  background:#444;
  color:#f2c94c;
  font-size:16px;
  margin-top:8px;
}

button:active { transform:scale(0.98); }

input, select {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:14px;
  border:none;
  background:#2b2b2b;
  color:#fff;
  font-size:15px;
}

.small {
  font-size:13px;
  opacity:0.85;
}

.highlight {
  color:#f2c94c;
  font-weight:600;
}
</style>
</head>

<body>

<header>muscle Log</header>

<h1>Muscle Log</h1>

<div class="container">

<!-- ACTIVE EXERCISE -->
<div class="card">
  <div class="highlight">Active Exercise</div>
  <div id="currentExercise">None</div>
  <div class="small">PR: <span id="prDisplay">—</span></div>
  <div class="small">Set: <span id="setCount">0</span></div>
</div>

<!-- CUSTOM EXERCISE -->
<div class="card">
  <div class="highlight">Change Exercise</div>
  <input id="customExercise" placeholder="Type any exercise">
  <button onclick="setExercise()">Use this exercise</button>
</div>

<!-- LOG SET -->
<div class="card">
  <div class="highlight">Log Set</div>
  <input id="weight" type="number" placeholder="Weight (kg)">
  <input id="reps" type="number" placeholder="Reps">
  <input id="rir" type="number" placeholder="RIR">
  <button onclick="saveSet()">Save Set</button>
</div>

<!-- BUILD WORKOUT -->
<div class="card">
  <div class="highlight">Build Workout</div>
  <input id="workoutName" placeholder="Workout name">
  <input id="workoutExercise" placeholder="Add exercise">
  <button onclick="addToWorkout()">Add Exercise</button>
  <div id="workoutPreview" class="small" style="margin-top:8px;"></div>
  <button onclick="saveWorkout()">Save Workout</button>
</div>

<!-- LOAD WORKOUT -->
<div class="card">
  <div class="highlight">Load Workout</div>
  <select id="workoutSelect" onchange="loadWorkout()">
    <option value="">Select workout</option>
  </select>
</div>

</div>

<script>
let currentExercise = null;
let setCount = 0;
let workoutBuffer = [];

const logs = JSON.parse(localStorage.getItem("logs") || "{}");
const prs = JSON.parse(localStorage.getItem("prs") || "{}");
const workouts = JSON.parse(localStorage.getItem("workouts") || "{}");

function setExercise() {
  const name = document.getElementById("customExercise").value.trim();
  if (!name) return;

  currentExercise = name;
  setCount = 0;

  document.getElementById("currentExercise").innerText = name;
  document.getElementById("setCount").innerText = "0";
  document.getElementById("prDisplay").innerText =
    prs[name] ? `${prs[name].weight}kg x ${prs[name].reps}` : "—";
}

function saveSet() {
  if (!currentExercise) return alert("Select an exercise first");

  const w = +weight.value;
  const r = +reps.value;
  if (!w || !r) return;

  setCount++;
  document.getElementById("setCount").innerText = setCount;

  const score = w * r;
  if (!prs[currentExercise] || score > prs[currentExercise].score) {
    prs[currentExercise] = { weight:w, reps:r, score };
    document.getElementById("prDisplay").innerText = `${w}kg x ${r}`;
    localStorage.setItem("prs", JSON.stringify(prs));
  }

  logs[Date.now()] = {
    exercise: currentExercise,
    weight: w,
    reps: r,
    rir: rir.value
  };

  localStorage.setItem("logs", JSON.stringify(logs));

  weight.value = reps.value = rir.value = "";
}

function addToWorkout() {
  const ex = document.getElementById("workoutExercise").value.trim();
  if (!ex) return;

  workoutBuffer.push(ex);
  document.getElementById("workoutExercise").value = "";
  renderWorkoutPreview(workoutBuffer);
}

function renderWorkoutPreview(list) {
  document.getElementById("workoutPreview").innerHTML =
    list.map((e,i) => `${i+1}. ${e}`).join("<br>");
}

function saveWorkout() {
  const name = document.getElementById("workoutName").value.trim();
  if (!name || workoutBuffer.length === 0) return;

  workouts[name] = [...workoutBuffer];
  localStorage.setItem("workouts", JSON.stringify(workouts));

  workoutBuffer = [];
  document.getElementById("workoutName").value = "";
  document.getElementById("workoutPreview").innerHTML = "";

  updateWorkoutSelect();
}

function updateWorkoutSelect() {
  const sel = document.getElementById("workoutSelect");
  sel.innerHTML = '<option value="">Select workout</option>';

  Object.keys(workouts).forEach(w => {
    const o = document.createElement("option");
    o.value = w;
    o.innerText = w;
    sel.appendChild(o);
  });
}

function loadWorkout() {
  const select = document.getElementById("workoutSelect");
  const name = select.value;
  if (!name) return;

  const exs = workouts[name];
  if (!exs || !exs.length) return;

  renderWorkoutPreview(exs);

  currentExercise = exs[0];
  document.getElementById("customExercise").value = currentExercise;
  setExercise();
}

updateWorkoutSelect();
</script>

</body>
</html>
