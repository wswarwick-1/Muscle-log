<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Training Log</title>

<style>
:root {
  --bg:#2f2f2f;
  --card:#3a3a3a;
  --accent:#f2c94c;
  --text:#fff;
}

body {
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
}

header {
  background:#1f1f1f;
  padding:14px 16px;
  display:flex;
  justify-content:space-between;
  font-weight:700;
  text-transform:lowercase;
}

h1 {
  text-align:center;
  color:var(--accent);
  margin:20px 0;
}

.card {
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin:12px;
}

label {
  color:var(--accent);
  font-weight:600;
  display:block;
  margin-bottom:6px;
}

select,input,button {
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  font-size:16px;
  margin-top:6px;
}

select,input {
  background:#222;
  color:#fff;
}

button {
  background:#444;
  color:var(--accent);
  font-weight:700;
}

.timer {
  font-size:36px;
  text-align:center;
  margin:12px 0;
}

.hidden { display:none; }
</style>
</head>

<body>

<header>
  <span>training log</span>
  <span onclick="toggleLog()">log</span>
</header>

<h1>Training Log</h1>

<div class="card">
  <label>Current Exercise</label>
  <div id="currentExercise">None</div>
  <div>PR: <span id="pr">—</span></div>
  <div>Last: <span id="last">—</span></div>
  <div>Set: <span id="setCount">0</span></div>
</div>

<div class="card">
  <label>Workout</label>
  <select id="workoutSelect"></select>
</div>

<div class="card">
  <label>Exercise</label>
  <select id="exerciseSelect"></select>
  <input id="customExercise" placeholder="Or type custom exercise">
  <button onclick="useCustomExercise()">Use custom exercise</button>
</div>

<div class="card">
  <label>Log Set</label>
  <input id="weight" type="number" placeholder="Weight (kg)">
  <input id="reps" type="number" placeholder="Reps">
  <button onclick="saveSet()">Save Set</button>
</div>

<div class="card">
  <label>Rest Timer (seconds)</label>
  <input id="restInput" type="number" value="90">
  <div class="timer" id="timer">00:00</div>
  <button onclick="startTimer()">Start</button>
  <button onclick="resetTimer()">Reset</button>
</div>

<!-- CUSTOM WORKOUT BUILDER -->
<div class="card">
  <label>Create Custom Workout</label>
  <input id="newWorkoutName" placeholder="Workout name">
  <input id="newWorkoutExercise" placeholder="Exercise name">
  <button onclick="addExerciseToBuilder()">Add Exercise</button>
  <div id="builderPreview"></div>
  <button onclick="saveCustomWorkout()">Save Workout</button>
</div>

<!-- LOG PAGE -->
<div id="logPage" class="hidden">
  <h1>Workout Log</h1>
  <div id="logContent"></div>
</div>

<script>
/* ---------- DATA ---------- */
let workouts = JSON.parse(localStorage.getItem("workouts")) || {
  Push:["Bench Press","OHP","Incline DB Press","Dips"],
  Pull:["Pull-up","Row","Lat Pulldown","RDL"],
  Legs:["Squat","Hack Squat","Leg Press","Ham Curl"]
};

let logs = JSON.parse(localStorage.getItem("logs")||"{}");
let prs  = JSON.parse(localStorage.getItem("prs")||"{}");

/* ---------- STATE ---------- */
let currentExercise=null;
let setCount=0;
let builderBuffer=[];

/* ---------- ELEMENTS ---------- */
const workoutSelect=document.getElementById("workoutSelect");
const exerciseSelect=document.getElementById("exerciseSelect");

/* ---------- INIT ---------- */
function init(){
  workoutSelect.innerHTML="";
  Object.keys(workouts).forEach(w=>{
    workoutSelect.innerHTML+=`<option>${w}</option>`;
  });
  loadExercises();
}
init();

/* ---------- WORKOUT / EXERCISES ---------- */
function loadExercises(){
  exerciseSelect.innerHTML="";
  workouts[workoutSelect.value].forEach(e=>{
    exerciseSelect.innerHTML+=`<option>${e}</option>`;
  });
  selectExercise();
}

function selectExercise(){
  currentExercise=exerciseSelect.value;
  setCount=0;
  document.getElementById("currentExercise").textContent=currentExercise;
  document.getElementById("setCount").textContent=0;
  document.getElementById("pr").textContent=prs[currentExercise]||"—";
  document.getElementById("last").textContent=
    logs[currentExercise]?.slice(-1)[0]||"—";
}

function useCustomExercise(){
  const val=document.getElementById("customExercise").value;
  if(!val) return;
  currentExercise=val;
  document.getElementById("currentExercise").textContent=val;
}

/* ---------- LOGGING ---------- */
function saveSet(){
  if(!currentExercise) return;
  const w=weight.value;
  const r=reps.value;
  if(!w||!r) return;

  const entry=`${w}kg x ${r}`;
  logs[currentExercise]=logs[currentExercise]||[];
  logs[currentExercise].push(entry);

  if(!prs[currentExercise] || parseInt(w)>parseInt(prs[currentExercise])){
    prs[currentExercise]=entry;
  }

  localStorage.setItem("logs",JSON.stringify(logs));
  localStorage.setItem("prs",JSON.stringify(prs));

  document.getElementById("last").textContent=entry;
  document.getElementById("pr").textContent=prs[currentExercise];
  document.getElementById("setCount").textContent=++setCount;
}

/* ---------- TIMER ---------- */
let timerInt;
function startTimer(){
  let t=parseInt(restInput.value);
  clearInterval(timerInt);
  timerInt=setInterval(()=>{
    timer.textContent=
      String(Math.floor(t/60)).padStart(2,"0")+":"+
      String(t%60).padStart(2,"0");
    if(--t<0){
      clearInterval(timerInt);
      navigator.vibrate?.(500);
      new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();
    }
  },1000);
}
function resetTimer(){
  clearInterval(timerInt);
  timer.textContent="00:00";
}

/* ---------- CUSTOM WORKOUT BUILDER ---------- */
function addExerciseToBuilder(){
  const ex=document.getElementById("newWorkoutExercise").value;
  if(!ex) return;
  builderBuffer.push(ex);
  document.getElementById("newWorkoutExercise").value="";
  document.getElementById("builderPreview").innerHTML=
    builderBuffer.map((e,i)=>`${i+1}. ${e}`).join("<br>");
}

function saveCustomWorkout(){
  const name=document.getElementById("newWorkoutName").value;
  if(!name||builderBuffer.length===0) return alert("Add name & exercises");
  workouts[name]=[...builderBuffer];
  localStorage.setItem("workouts",JSON.stringify(workouts));
  builderBuffer=[];
  document.getElementById("builderPreview").innerHTML="";
  document.getElementById("newWorkoutName").value="";
  init();
}

/* ---------- LOG PAGE ---------- */
function toggleLog(){
  logPage.classList.toggle("hidden");
  logContent.innerHTML="";
  Object.keys(workouts).forEach(w=>{
    logContent.innerHTML+=`<h2>${w}</h2>`;
    workouts[w].forEach(e=>{
      if(logs[e]){
        logs[e].forEach(l=>{
          logContent.innerHTML+=`<div class="card">${e}: ${l}</div>`;
        });
      }
    });
  });
}

workoutSelect.onchange=loadExercises;
exerciseSelect.onchange=selectExercise;
</script>

</body>
</html>
