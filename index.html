<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Training Log</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #2f2f2f;
  color: #f5f5f5;
}

header {
  background: #1f1f1f;
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

header span {
  color: #f2c94c;
  font-size: 18px;
  font-weight: 700;
}

header a {
  color: #f2c94c;
  text-decoration: none;
  font-weight: 600;
}

.card {
  background: #3a3a3a;
  border-radius: 14px;
  padding: 14px;
  margin: 14px;
}

label {
  color: #f2c94c;
  font-weight: 600;
}

select, input, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  border-radius: 10px;
  border: none;
  background: #222;
  color: #fff;
  font-size: 16px;
}

button {
  background: #444;
  color: #f2c94c;
  font-weight: 700;
}

.timer {
  font-size: 32px;
  text-align: center;
  margin: 10px 0;
}
</style>
</head>

<body>

<header>
  <span>training log</span>
  <a href="log.html">log</a>
</header>

<div class="card">
  <label>Current Exercise</label>
  <div id="currentExercise">None</div>
  <div>PR: <span id="pr">—</span></div>
  <div>Last: <span id="last">—</span></div>
  <div>Set: <span id="setCount">0</span></div>
</div>

<div class="card">
  <label>Workout</label>
  <select id="workoutSelect"></select>
</div>

<div class="card">
  <label>Exercise</label>
  <select id="exerciseSelect"></select>
  <input id="customExercise" placeholder="Or type exercise">
  <button onclick="useCustomExercise()">Use custom exercise</button>
</div>

<div class="card">
  <label>Log Set</label>
  <input id="weight" type="number" placeholder="Weight (kg)">
  <input id="reps" type="number" placeholder="Reps">
  <button onclick="saveSet()">Save Set</button>
</div>

<div class="card">
  <label>Rest Timer (seconds)</label>
  <input id="restInput" type="number" value="90">
  <div class="timer" id="timer">00:00</div>
  <button onclick="startTimer()">Start</button>
  <button onclick="resetTimer()">Reset</button>
</div>

<script>
/* ---------- DATA ---------- */
const DEFAULT_WORKOUTS = {
  Push: ["Bench Press", "OHP", "Dips"],
  Pull: ["Row", "Pull-up", "Lat Pulldown"],
  Legs: ["Squat", "RDL", "Leg Press"]
};

let workouts = JSON.parse(localStorage.getItem("workouts"));
if (!workouts) {
  workouts = DEFAULT_WORKOUTS;
  localStorage.setItem("workouts", JSON.stringify(workouts));
}

let logs = JSON.parse(localStorage.getItem("logs")) || [];
let prs  = JSON.parse(localStorage.getItem("prs")) || {};

let currentWorkout = null;
let currentExercise = null;
let setCount = 0;

/* ---------- ELEMENTS ---------- */
const workoutSelect = document.getElementById("workoutSelect");
const exerciseSelect = document.getElementById("exerciseSelect");

/* ---------- INIT ---------- */
function renderWorkouts() {
  workoutSelect.innerHTML = "<option value=''>Select workout</option>";
  Object.keys(workouts).forEach(w => {
    workoutSelect.innerHTML += `<option value="${w}">${w}</option>`;
  });
}
renderWorkouts();

/* ---------- WORKOUT CHANGE ---------- */
workoutSelect.onchange = () => {
  currentWorkout = workoutSelect.value;
  currentExercise = null;
  setCount = 0;

  document.getElementById("currentExercise").innerText = "None";
  document.getElementById("setCount").innerText = "0";

  exerciseSelect.innerHTML = "<option value=''>Select exercise</option>";
  if (!currentWorkout) return;

  workouts[currentWorkout].forEach(ex => {
    exerciseSelect.innerHTML += `<option value="${ex}">${ex}</option>`;
  });
};

/* ---------- EXERCISE CHANGE (FIXED) ---------- */
exerciseSelect.onchange = () => {
  const ex = exerciseSelect.value;
  if (!ex) return;

  currentExercise = ex;
  setCount = 0;

  document.getElementById("currentExercise").innerText = ex;
  document.getElementById("setCount").innerText = "0";

  const last = logs.filter(l => l.exercise === ex).slice(-1)[0];
  document.getElementById("last").innerText =
    last ? `${last.weight}kg × ${last.reps}` : "—";

  const pr = prs[ex];
  document.getElementById("pr").innerText =
    pr ? `${pr.weight}kg × ${pr.reps}` : "—";
};

/* ---------- CUSTOM EXERCISE ---------- */
function useCustomExercise() {
  const ex = customExercise.value.trim();
  if (!ex) return;
  if (!currentWorkout) {
    alert("Select a workout first");
    return;
  }

  currentExercise = ex;
  setCount = 0;

  document.getElementById("currentExercise").innerText = ex;
  document.getElementById("setCount").innerText = "0";

  customExercise.value = "";
}

/* ---------- SAVE SET ---------- */
function saveSet() {
  if (!currentWorkout || !currentExercise) {
    alert("Select workout and exercise first");
    return;
  }

  const w = +weight.value;
  const r = +reps.value;
  if (!w || !r) return;

  setCount++;
  document.getElementById("setCount").innerText = setCount;

  const entry = {
    workout: currentWorkout,
    exercise: currentExercise,
    weight: w,
    reps: r,
    date: new Date().toISOString().slice(0,10)
  };

  logs.push(entry);
  localStorage.setItem("logs", JSON.stringify(logs));

  if (!prs[currentExercise] || w > prs[currentExercise].weight) {
    prs[currentExercise] = { weight: w, reps: r };
    localStorage.setItem("prs", JSON.stringify(prs));
  }

  document.getElementById("last").innerText = `${w}kg × ${r}`;
  document.getElementById("pr").innerText =
    `${prs[currentExercise].weight}kg × ${prs[currentExercise].reps}`;

  weight.value = "";
  reps.value = "";
}

/* ---------- TIMER ---------- */
let tInt;
function startTimer() {
  let t = +restInput.value;
  clearInterval(tInt);
  updateTimer(t);

  tInt = setInterval(() => {
    t--;
    updateTimer(t);
    if (t <= 0) {
      clearInterval(tInt);
      navigator.vibrate?.(300);
    }
  }, 1000);
}

function resetTimer() {
  clearInterval(tInt);
  timer.innerText = "00:00";
}

function updateTimer(t) {
  timer.innerText =
    String(Math.floor(t / 60)).padStart(2, "0") + ":" +
    String(t % 60).padStart(2, "0");
}
</script>

</body>
</html>
