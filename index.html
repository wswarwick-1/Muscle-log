<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Muscle Log</title>

<style>
body { background:#2b2b2b; color:#f5f5f5; font-family:Arial; padding:16px; }
h1 { text-align:center; color:#f2c94c; }
button { width:100%; padding:14px; margin:6px 0; background:#3a3a3a; color:#f2c94c; border:1px solid #555; border-radius:10px; }
.exercise.active { background:#f2c94c; color:#000; }
.card { background:#383838; border:1px solid #555; border-radius:12px; padding:14px; margin:10px 0; }
input { width:100%; padding:12px; margin:6px 0; background:#444; color:#fff; border:1px solid #666; border-radius:10px; }
.timer { font-size:32px; text-align:center; color:#f2c94c; }
.log { font-size:14px; border-bottom:1px solid #555; padding:4px 0; }
.small { font-size:13px; opacity:0.8; }
</style>
</head>

<body>

<h1>Muscle Log</h1>

<button onclick="loadDay('A')">Day A â€“ Heavy</button>
<button onclick="loadDay('B')">Day B â€“ Volume</button>

<div class="card" id="status">No exercise selected</div>
<div class="card" id="sets">Set: 0</div>

<button onclick="changeExercise()">Change Exercise</button>

<div id="exercises"></div>

<input id="w" placeholder="Weight (kg)">
<input id="r" placeholder="Reps">
<input id="rir" placeholder="RIR">

<button onclick="saveSet()">Save Set</button>

<div class="card">
  <h2>Rest Timer</h2>
  <div class="small">Rest time (seconds)</div>
  <input id="restInput" type="number" min="10" step="10">
  <div class="timer" id="timer">01:00</div>
  <button onclick="startTimer()">Start</button>
  <button onclick="resetTimer()">Reset</button>
</div>

<div class="card">
  <h2>Log</h2>
  <div id="log"></div>
</div>

<script>
/* DOM REFERENCES (CRITICAL FIX) */
const exercisesDiv = document.getElementById("exercises");
const statusDiv = document.getElementById("status");
const setsDiv = document.getElementById("sets");
const logDiv = document.getElementById("log");
const restInput = document.getElementById("restInput");
const timerDisplay = document.getElementById("timer");
const w = document.getElementById("w");
const r = document.getElementById("r");
const rir = document.getElementById("rir");

/* DATA */
const workouts = {
  A:["Goblet Squat","RDL","Push-Ups","OHP","Row","Pull-ups"],
  B:["Split Squat","DB RDL","DB Press","Lateral Raise","Curl","Triceps"]
};

let currentExercise = "";
let currentDay = "A";
let setCount = 0;
let timer = 60;
let interval = null;
let logs = JSON.parse(localStorage.getItem("logs") || "[]");

/* REST TIMER PREF */
const savedRest = parseInt(localStorage.getItem("restTime")) || 60;
restInput.value = savedRest;
timer = savedRest;
updateTimer();

/* LOAD DAY */
function loadDay(day){
  currentDay = day;
  exercisesDiv.innerHTML = "";
  currentExercise = "";
  setCount = 0;
  setsDiv.innerText = "Set: 0";
  statusDiv.innerText = "No exercise selected";

  workouts[day].forEach(name=>{
    const btn = document.createElement("button");
    btn.innerText = name;
    btn.className = "exercise";
    btn.onclick = ()=>selectExercise(name, btn);
    exercisesDiv.appendChild(btn);
  });
}

/* SELECT EXERCISE */
function selectExercise(name, btn){
  document.querySelectorAll(".exercise").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  currentExercise = name;
  setCount = 0;
  setsDiv.innerText = "Set: 0";
  statusDiv.innerText = "Selected: " + name;
}

/* CHANGE EXERCISE */
function changeExercise(){
  currentExercise = "";
  setCount = 0;
  setsDiv.innerText = "Set: 0";
  statusDiv.innerText = "Select a new exercise";

  document.querySelectorAll(".exercise").forEach(b=>{
    b.classList.remove("active");
    b.disabled = false;   // ðŸ”‘ ensure buttons are re-selectable
  });
}

/* SAVE SET */
function saveSet(){
  if(!currentExercise){
    alert("Select an exercise first");
    return;
  }

  setCount++;
  setsDiv.innerText = "Set: " + setCount;

  logs.push({
    date:new Date().toISOString().split("T")[0],
    day:currentDay,
    exercise:currentExercise,
    weight:w.value,
    reps:r.value,
    rir:rir.value
  });

  localStorage.setItem("logs", JSON.stringify(logs));
  drawLog();
}

/* DRAW LOG */
function drawLog(){
  logDiv.innerHTML = "";
  logs.slice().reverse().forEach(e=>{
    logDiv.innerHTML += `<div class="log">${e.day} â€“ ${e.exercise} â€” ${e.weight}kg Ã— ${e.reps}</div>`;
  });
}

/* TIMER */
function startTimer(){
  if(interval) return;
  timer = parseInt(restInput.value) || 60;
  localStorage.setItem("restTime", timer);
  updateTimer();

  interval = setInterval(()=>{
    timer--;
    updateTimer();
    if(timer <= 0){
      clearInterval(interval);
      interval = null;
      if(navigator.vibrate) navigator.vibrate([300,150,300]);
    }
  },1000);
}

function resetTimer(){
  clearInterval(interval);
  interval = null;
  timer = parseInt(restInput.value) || 60;
  updateTimer();
}

function updateTimer(){
  timerDisplay.innerText = "00:" + String(timer).padStart(2,"0");
}

/* INIT */
loadDay("A");
drawLog();
</script>

</body>
</html>

