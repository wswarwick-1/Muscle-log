<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Muscle Log</title>

<style>
body {
  background:#2f2f2f;
  color:#f5f5f5;
  font-family:Arial, sans-serif;
  margin:0;
}
header {
  background:#1f1f1f;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1 {
  color:#f2c94c;
  margin:0;
  font-size:20px;
}
header a {
  color:#f2c94c;
  text-decoration:none;
  font-weight:bold;
}
.container {
  padding:16px;
}
.card {
  background:#3a3a3a;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
h2 {
  color:#f2c94c;
  margin-top:0;
}
input, select, button {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:12px;
  border:none;
  background:#2a2a2a;
  color:#fff;
  font-size:16px;
}
button {
  background:#3f3f3f;
  color:#f2c94c;
  font-weight:bold;
}
.timer {
  font-size:32px;
  text-align:center;
  margin:10px 0;
}
.small {
  opacity:.8;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <h1>muscle Log</h1>
  <a href="log.html">Log</a>
</header>

<div class="container">

<div class="card">
<h2>Current Exercise</h2>
<div id="currentExercise">None</div>
<div class="small">PR: <span id="pr">—</span></div>
<div class="small">Last time: <span id="last">—</span></div>
<div class="small">Set: <span id="setCount">0</span></div>
</div>

<div class="card">
<h2>Workout</h2>
<select id="workoutSelect" onchange="loadWorkout()"></select>
</div>

<div class="card">
<h2>Exercise</h2>
<select id="exerciseSelect" onchange="selectExercise()"></select>

<input id="customExercise" placeholder="Or type custom exercise">
<button onclick="useCustomExercise()">Use custom exercise</button>
</div>

<div class="card">
<h2>Log Set</h2>
<input id="weight" placeholder="Weight (kg)" type="number">
<input id="reps" placeholder="Reps" type="number">
<input id="rir" placeholder="RIR (optional)">
<button onclick="saveSet()">Save Set</button>
</div>

<div class="card">
<h2>Rest Timer</h2>
<input id="restInput" type="number" value="90">
<div class="timer" id="timer">00:00</div>
<button onclick="startTimer()">Start</button>
<button onclick="resetTimer()">Reset</button>
</div>

</div>

<script>
/* ---------- DATA ---------- */
let workouts = JSON.parse(localStorage.getItem("workouts")) || {
  Push:["Bench Press","OHP","Incline DB Press"],
  Pull:["RDL","Lat Pulldown","Barbell Row"],
  Legs:["Squat","Hack Squat","Leg Press"]
};
let logs = JSON.parse(localStorage.getItem("logs")) || [];
let prs = JSON.parse(localStorage.getItem("prs")) || {};

let currentWorkout = "";
let currentExercise = "";
let setCount = 0;

/* ---------- INIT ---------- */
function init(){
  const w = document.getElementById("workoutSelect");
  w.innerHTML = "<option value=''>Select workout</option>";
  Object.keys(workouts).forEach(k=>{
    w.innerHTML += `<option>${k}</option>`;
  });
}
init();

/* ---------- WORKOUT ---------- */
function loadWorkout(){
  currentWorkout = workoutSelect.value;
  exerciseSelect.innerHTML = "<option value=''>Select exercise</option>";
  workouts[currentWorkout].forEach(e=>{
    exerciseSelect.innerHTML += `<option>${e}</option>`;
  });
}

/* ---------- EXERCISE ---------- */
function selectExercise(){
  setExercise(exerciseSelect.value);
}

function useCustomExercise(){
  const ex = customExercise.value.trim();
  if(!ex) return;
  setExercise(ex);
}

function setExercise(ex){
  currentExercise = ex;
  setCount = 0;
  updateExerciseCard();
}

function updateExerciseCard(){
  document.getElementById("currentExercise").innerText = currentExercise || "None";
  document.getElementById("setCount").innerText = setCount;
  document.getElementById("pr").innerText = prs[currentExercise] || "—";

  const last = logs.filter(l=>l.exercise===currentExercise).slice(-1)[0];
  document.getElementById("last").innerText =
    last ? `${last.weight}kg x ${last.reps}` : "—";
}

/* ---------- SAVE SET ---------- */
function saveSet(){
  if(!currentExercise || !currentWorkout) return alert("Select workout & exercise");

  const w = +weight.value;
  const r = +reps.value;
  if(!w || !r) return;

  setCount++;

  logs.push({
    date:new Date().toISOString().slice(0,10),
    workout:currentWorkout,
    exercise:currentExercise,
    weight:w,
    reps:r,
    rir:rir.value||""
  });

  if(!prs[currentExercise] || w > prs[currentExercise]){
    prs[currentExercise] = w;
  }

  localStorage.setItem("logs",JSON.stringify(logs));
  localStorage.setItem("prs",JSON.stringify(prs));

  weight.value = reps.value = rir.value = "";
  updateExerciseCard();
}

/* ---------- TIMER ---------- */
let timerInt, remaining;

function startTimer(){
  remaining = +restInput.value;
  if(!remaining) return;
  updateTimer();
  clearInterval(timerInt);
  timerInt = setInterval(()=>{
    remaining--;
    updateTimer();
    if(remaining<=0){
      clearInterval(timerInt);
      navigator.vibrate?.(300);
      new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQgAAAA=").play();
    }
  },1000);
}

function resetTimer(){
  clearInterval(timerInt);
  timer.innerText="00:00";
}

function updateTimer(){
  timer.innerText =
    String(Math.floor(remaining/60)).padStart(2,"0")+":"+
    String(remaining%60).padStart(2,"0");
}
</script>
</body>
</html>
